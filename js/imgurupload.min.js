!function(e){"use strict";var t=[],n="function"==typeof Uint8Array&&"function"==typeof FileReader&&"function"==typeof Image&&"object"==typeof document.createElement("canvas"),i=function(t,i){var a,o;if(!n)return!1;a=-1!==t.split(",")[0].indexOf("base64")?atob(t.split(",")[1]):decodeURI(t.split(",")[1]),o=t.split(",")[0].split(":")[1].split(";")[0];for(var r=new Array,l=0;l<a.length;l++)r[l]=a.charCodeAt(l);var c=new File([new Uint8Array(r)],i.name,{type:o}),u=["upload","status","previewElement","previewTemplate","accepted"];return e.each(u,function(e,t){c[t]=i[t]}),c},a=function(e,t){var n,i,a;t+="\n",document.selection?(e.focus(),n=document.selection.createRange(),n.text=t):e.selectionStart||"0"==e.selectionStart?(i=e.selectionStart,a=e.selectionEnd,e.value=e.value.substring(0,i)+t+e.value.substring(a,e.value.length)):e.value+=t},o=function(t){var n,i,a=t.link.replace(/^http:/i,"https:"),o="1"===gdn.definition("resizeimages"),r=e("#Form_Format").val();switch(o&&(i=a.split("."),i[i.length-2]+="h",i=i.join(".")),r.toLowerCase()){case"bbcode":n=o?"[url="+a+"][img]"+i+"[/img][/url]":"[img]"+a+"[/img]";break;case"markdown":n=o?"[![]("+i+")]("+a+")":"![]("+a+")";break;case"html":n=o?'<a href="'+a+'" target="_new"><img src="'+i+'" alt="" /></a>':'<img src="'+a+'" alt="" width="'+t.width+'" height="'+t.height+'" />';break;default:n=a}return n},r=function(e,t,i){return{sending:function(){},queuecomplete:function(){},success:function(t,n){n.success?a(e[0],o(n.data)):alert("Something went wrong trying to upload your images :( \n\nOur image host, imgur.com, may be having technical issues. Give it a few minutes and try again.")},autoQueue:!n,acceptedFiles:"image/*",paramName:"image",clickable:i,method:"post",maxFilesize:20,maxFiles:20,previewsContainer:t[0],thumbnailWidth:60,thumbnailHeight:60,fallback:function(){},url:"https://api.imgur.com/3/upload",headers:{Authorization:"Client-ID "+gdn.definition("imgurclientid"),Accept:"application/json"}}},l=function(e){n&&e.on("addedfile",function(t){var n=new FileReader,a=Number(gdn.definition("imgmaxwidth"))||-1,o=Number(gdn.definition("imgmaxheight"))||-1;n.addEventListener("load",function(n){var r=new Image;r.src=n.target.result,r.addEventListener("load",function(n){var l=n.target.width,c=n.target.height;if((a<=0||l<=a)&&(o<=0||c<=o))return void e.enqueueFile(t);l>c?l>a&&(c*=a/l,l=a):c>o&&(l*=o/c,c=o);var u=document.createElement("canvas");u.width=l,u.height=c,u.getContext("2d").drawImage(r,0,0,l,c);var d=i(u.toDataURL("image/jpeg"),t),s=e.files.indexOf(t);e.files[s]=d,e.enqueueFile(d)})}),n.readAsDataURL(t)})},c=function(n){var i,c=n.parents("form"),u=-1,d=c.find("[type=submit]").last(),s=e("<div/>",{class:"imguruploader-preview-ctx"});n.length&&(n.attr("placeholder","You can now drag and drop images here to add them to your post! They will appear wherever your caret is."),n.after(s),"1"===gdn.definition("enabledragdrop")&&(t.push(new Dropzone(n[0],r(n,s,!1))),u=t.length-1,l(t[t.length-1])),("ontouchstart"in window||"1"===gdn.definition("showimagesbtn"))&&(n.attr("placeholder",""),i=e('<a href="#" class="Button ButtonAddImages">Add Images</a>').on("click",function(e){e.preventDefault()}),d.before(i),t.push(new Dropzone(i[0],r(n,s,!0))),l(t[t.length-1])),d.on("click",function(){s.empty()}),u>-1&&n.on("paste",function(e){var n,i=e.originalEvent.clipboardData.items;for(n=0;n<i.length;n++)"file"===i[n].kind&&i[n].type.indexOf("image/")>-1&&t[u].addFile(i[n].getAsFile())}),"1"===gdn.definition("processimageurls")&&n.on("drop",function(e){var t=e.originalEvent.dataTransfer.getData("URL");t.length&&(e.preventDefault(),e.stopPropagation(),t.match(/([a-z\-_0-9\/\:\.]*\.(jpg|jpeg|png|gif))/i)?a(n[0],o({link:t})):a(n[0],t))}))};e(function(){var t=e("#Form_Body");c(t),e(document).on("EditCommentFormLoaded",function(){e(".EditCommentForm").find("textarea").each(function(){c(e(this))})})})}(jQuery);
//# sourceMappingURL=imgurupload.js.map